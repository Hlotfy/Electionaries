<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcome to Firebase Hosting</title>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-analytics.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
  <!-- <script src="/__/firebase/init.js"></script> -->
  <!-- <script  src="/__/firebase/7.1.0/firebase-database.js"></script>
  <script  src="/__/firebase/7.1.0/firebase-messaging.js"></script>
  <script  src="/__/firebase/7.1.0/firebase-storage.js"></script> -->
  <!-- initialize the SDK after all desired features are loaded -->
  <!-- <script  src="/__/firebase/init.js"></script> -->
  <style media="screen">
    body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
    #note { border: solid; border-width: thin; background-color:powderblue; text-align: left; display: inline-block; visibility:visible; padding: 3px; margin: 8px;}
    #blurb {padding: 5px;}
    #blurb:hover {border: solid; border-width: thin; background-color: lightsteelblue;}
    #profile {background-color: rgb(226, 226, 226); width: 40%; padding: 5px; margin: 10px;}
    #profile_body {border: solid; border-width: thin; background-color: rgb(242, 248, 248); padding: 5px; margin: 3px; position:relative;}
    #connections { background-color: lightcyan; padding: 5px; margin: 3px; }
    #conn_list {border: solid; border-width: thin; display:inline-grid; width: 40%; padding: 5px; margin: 3px;position:relative; right: 0px; top:0px;}
    #conn_list h2 { color:violet; font-weight: bold; }
    #message { background: white; max-width: 700px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
    #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
    #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
    #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
    #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
    #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
    #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
    @media (max-width: 600px) {
      body, #message { margin-top: 0; background: white; box-shadow: none; }
      body { border-top: 16px solid #ffa100; }
    }
    button {
      background-color: #f9ca24; /* Green */
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <div id="message">
    <h2>CS323 Term Project | Shirley, Dom, Hala </h2>
    <h1>Electionaries: A Social Network to Facilitate Civil Political Discussion</h1>
    <hr>
    <div id="userNameDisplay">
      <!-- <a href='profile.html?id="+doc.id+"'>" + doc.data().name +"</a> -->
    </div>
    <button id="sign-in" onclick="signIn()" >Sign-In</button>
    <button id="sign-out" onclick="signOut()" >Sign-Out</button>
    <hr>
    <h2>App Sketches</h2>
    <p>Activity Feed</p>
    <img src="p2_3.png" style="width:700px">
    <p>Profile and List of Users</p>
    <img src="ps2_1.png" style="width:700px">
    <p>Article/Annotation Page</p>
    <img src="p2_2.png" style="width:700px">
    <hr>
    <h2>ER Diagram</h2>
    <img src="ps2_diagram.png" style="width:700px">
    <hr>
    <h1 id="userDivTitle">5 Users Printed Below:</h2>
    <h5 id="usersDiv"></h5>
    <hr>
    <div id="article">
    <h1 id="blurbDivTitle">Multiple News "Blurbs" Printed Below:</h2>
    <h5 id="blurbsDiv"></h5>
    </div>
    <hr>
    <h1 id="annotationsDivTitle">5 User-Generated Annotations (Posts) Printed Below:</h2>
    <h5 id="annotationsDiv"></h5>

    <h1>Project Concept Background</h1>
    <hr>
    <p>
      Navigating modern day elections to get a balanced view of different topics can be tricky. As articulated in ‚ÄúBursting Your (Filter) Bubble: Strategies for Promoting Diverse Exposure,‚Äù social network sites can often create echo chambers for users, leading them to see content that reinforces their opinions, rather than different opinions to gain a broader perspective. The paper ‚ÄúThe top five reasons for lurking: improving community experiences for everyone‚Äù explains that sites also have design features that may not promote an encouraging environment for users to interact and engage. With the 2020 presidential election coming up, we designed a whole new social network site that encourages users to view summaries of election topics, read full articles from various conservative and liberal sites, as well as annotate and post fact-based comments. This social network site will provide users with the opportunity to view different news articles from various sites on both sides of the political spectrum, and also include design features that may potentially improve the community experience for all users.
    </p>
    <h1>References/Links</h1>
    <hr>
    <a href = "https://drive.google.com/file/d/1o9Cy--ODVdafGyLFjCpwuBa9VNAlZF0M/view">Social theory article</a>
    <a href = "https://www.dhi.ac.uk/san/waysofbeing/data/communities-murphy-preece-2004b.pdf">Social computing article</a>
    <a href = "https://github.com/Hlotfy/Electionaries">Open Github repository</a>
    <a href = "https://console.firebase.google.com/u/0/project/electionaries/overview">Open Firebase</a>
    <a target="_blank" href="https://firebase.google.com/docs/hosting/">Open Hosting Documentation</a>
  </div>
  <p id="load">Firebase SDK Loading&hellip;</p>

  <script>
    // Config Firebase
    var firebaseConfig = {
    apiKey: "AIzaSyBhaP1ekvDu6QExupaa04mC9gWV3Tjjxvk",
    authDomain: "electionaries.firebaseapp.com",
    databaseURL: "https://electionaries.firebaseio.com",
    projectId: "electionaries",
    storageBucket: "electionaries.appspot.com",
    messagingSenderId: "509982773157",
    appId: "1:509982773157:web:a775a480db86df3be0224c",
    measurementId: "G-M6HQRQGYGK"
    };
    // Initilaize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    var db = firebase.firestore();

    document.addEventListener('DOMContentLoaded', function() {
      // // üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
      // // The Firebase SDK is initialized and available here!
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
      // // üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
      try {
        let app = firebase.app();
        let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
        document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
      } catch (e) {
        console.error(e);
        document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
      }
    });

    //Sign in and Out
    function signIn() {
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider);
      // console.log("hi");
    }
    function signOut() {
       firebase.auth().signOut();
    }

    //Change signin/signout display based on log in state
    document.addEventListener('DOMContentLoaded', function() {
      firebase.auth().onAuthStateChanged( function(user){
        if (user) { // User is signed in!
            document.getElementById("sign-in").style.display = "none";
            document.getElementById("sign-out").style.display = "block";
            console.log("user is signed in; they are:" + firebase.auth().currentUser.displayName);

            document.getElementById("userNameDisplay").innerHTML = firebase.auth().currentUser.displayName;

            // document.getElementById("userNameDisplay").href = 'profile.html?id="+doc.id+"';
            // <a href='profile.html?id="+doc.id+"'>" + doc.data().name +"</a>

            var userImg = document.createElement('img');
            console.log("img div created, now linking it to src: " + firebase.auth().currentUser.photoURL);
            userImg.src = firebase.auth().currentUser.photoURL;
            userImg.setAttribute("width", "50");
            userImg.setAttribute("height", "50");
            document.getElementById("userNameDisplay").appendChild(userImg);
            console.log("img appended");
        } else { // User is signed out!
            document.getElementById("sign-in").style.display = "block";
            document.getElementById("sign-out").style.display = "none";
            document.getElementById("userNameDisplay").innerHTML = "";
        }
      });
    });

    //Print 5 Users
    var usersDiv = document.getElementById("usersDiv");

    db.collection("users").get().then(snapshot => {
      snapshot.forEach(doc => {
        var profile_block = document.createElement("div");
        profile_block.setAttribute("id","profile");
        profile_block.innerHTML += doc.data().firstname + " "+ doc.data().lastname + " (" +doc.id+ ") <br />";

        var profile_conn = document.createElement("div");
        profile_conn.setAttribute("id","connections");

        var following = document.createElement("div");
        following.setAttribute("id","conn_list");
        var title = document.createElement("h2");
        title.innerHTML = "Following";
        following.appendChild(title);


        db.collection("following").doc(doc.id).get().then(function(doc) {
          if (doc.exists) {
            for (field in doc.data()) {
              console.log(field);
              following.innerHTML += field + "<br />";
            }

          }
        })

        profile_conn.appendChild(following);
        var followers = document.createElement("div");
        followers.setAttribute("id","conn_list");

        var title = document.createElement("h2");
        title.innerHTML = "Followers";
        followers.appendChild(title);

        db.collection("followers").doc(doc.id).get().then(function(doc) {
          if (doc.exists) {
            for (field in doc.data()) {
              console.log(field);
              followers.innerHTML += field + "<br />";
            }

          }
        })


        profile_conn.appendChild(followers);
        var profile_bod = document.createElement("div");
        profile_bod.setAttribute("id","profile_body");

        profile_bod.appendChild(profile_conn);
        profile_block.appendChild(profile_bod);


        usersDiv.appendChild(profile_block);
      })
    });

    // var usersDiv = document.getElementById("usersDiv");
    // db.collection("users").doc("dhuang2").onSnapshot(function(doc) {
    //     usersDiv.innerHTML = doc.data().firstname + "<br />";
    //     // console.log("Current data: ", doc.data().firstname);
    // });
    // db.collection("users").doc("hlotfy").onSnapshot(function(doc) {
    //     usersDiv.innerHTML += doc.data().firstname + "<br />";
    // });
    // db.collection("users").doc("jordanblue").onSnapshot(function(doc) {
    //     usersDiv.innerHTML += doc.data().firstname + "<br />";
    // });
    // db.collection("users").doc("katiekay1").onSnapshot(function(doc) {
    //     usersDiv.innerHTML += doc.data().firstname + "<br />";
    // });
    // db.collection("users").doc("slei").onSnapshot(function(doc) {
    //     usersDiv.innerHTML += doc.data().firstname + "<br />";
    // });

    //Print multiple blurbs
    var blurbsDiv = document.getElementById("blurbsDiv");
    var article_id = document.getElementById("article");
    db.collection("articles").get().then(snapshot => {
      snapshot.forEach(doc => {
        var art_id = doc.id;
        var annotes = db.collection("annotations").where('article','==',doc.id).get().then(snapshot => {
          snapshot.forEach(doc => {
            console.log(doc.data());
          })
        });

        var art = document.createElement("div");
        var art_title = document.createElement("h2");
        var art_text = document.createElement("div");
        art_title.innerHTML = doc.data().title;
        art.appendChild(art_title);

        db.collection("articles/"+doc.id+"/blurbs").get().then(snapshot => {

          snapshot.forEach(doc => {
            var blurb = document.createElement("div")
            blurb.setAttribute("id","blurb");
            blurb.appendChild(document.createElement("h3")).innerHTML =  doc.data().text + "<br />";

            // for (i=1; i < size; i++) {
            //   var num = i.toString();
              // db.collection("articles").doc("nyt_1").collection("blurbs").doc(num).onSnapshot(function(doc) {
                // art_text.innerHTML += doc.data().text + "<br /> <br />";
                db.collection("annotations").where('article','==',art_id).where('blurb','==', parseInt(doc.id)).get().then(snapshot => {
                  snapshot.forEach(doc => {
                    console.log(doc.data());

                    var new_note = document.createElement("div")
                    new_note.setAttribute("id","note");
                    var txt = document.createElement("h4");
                    txt.innerHTML = doc.data().author +": <br />"+doc.data().text;
                    console.log(doc.data().text);
                    new_note.appendChild(txt);
                    blurb.appendChild(new_note);
                  })
                  })
                art_text.appendChild(blurb);

          // }
          })
          // art_text.innerHTML += "<hr> <hr>";
        })
        art.appendChild(art_text);
        blurbsDiv.appendChild(art);
        // blurbsDiv.appendChild(document.createElement("<hr>"));
    })

  });

    //Print 5 user-generated annotations
    var annotationsDiv = document.getElementById("annotationsDiv");
    db.collection("annotations").get().then(snapshot => {
      snapshot.forEach(doc => {
        var blurb = doc.data().blurb.toString();
        annotationsDiv.innerHTML += doc.data().article + " | Article section: " + blurb + " | " + doc.data().author+ ": "+ doc.data().text + "<br /> <br />";
      })
    });


  </script>
</body>
</html>
